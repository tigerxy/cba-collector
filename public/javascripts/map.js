!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}({15:function(e,t){function n(e,t){var n=$('<div class="alert alert-'+e+' alert-dismissible" role="alert">   <strong>'+t+'</strong>       <button class="close" type="button" data-dismiss="alert" aria-label="Close">           <span aria-hidden="true">&times;</span>       </button>');n.appendTo("#alert"),setTimeout(function(e){$(e[0]).alert("close")},5e3,n)}function o(e,t){t.forEach(t=>{e[1*(1==t.properties.yours||secLevel>2)].addData(t)})}$.ajaxSetup({headers:{token:token}});var a=L.Icon.extend({options:{iconSize:[30,35],iconAnchor:[15,35],popupAnchor:[0,-37]}}),i=new a({iconUrl:"/images/tree_green.png"}),r=new a({iconUrl:"/images/tree_yellow.png"}),c=new a({iconUrl:"/images/tree_red.png"}),s=new a({iconUrl:"/images/tree_grey.png"}),l=L.map("map").fitWorld();L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(l);var u=L.circle([51,9],{radius:15e5});u.addTo(l);var d,f=function(e,t){var n;switch(e.properties.status[e.properties.status.length-1].action){case"remove":n=s;break;case"add":n=c;break;case"assigned":n=r;break;case"collected":n=i;break;default:n=s}return L.marker(t,{icon:n})},p=function(e,t){t.on("click",function(){v("edit",e)}),$("body").on("update",function(t,n){n._id==e._id&&(e=n,console.log("My ID is "+n._id))})},g=L.geoJSON([],{style:{color:"red",fill:!0,fillOpacity:0},onEachFeature:function(e,t){secLevel>1&&t.bindTooltip(e.properties.number+": "+e.properties.name,{sticky:!0,interactive:!0})}}),y=L.geoJSON([],{style:{color:"gray",opacity:.5,fill:!0,fillColor:"gray"}}),h=L.geoJSON([],{pointToLayer:f,onEachFeature:p}),b=L.geoJSON([],{pointToLayer:f,onEachFeature:p});L.control.layers({},{"Mein Gebiet":g,"Andere Gebiete":y,"Meine Bäume":h,"Andere Bäume":b}).addTo(l),l.addLayer(h),2!=secLevel&&(l.addLayer(g),l.addLayer(y),l.addLayer(b)),L.easyButton("fa-crosshairs",function(e,t){t.fitBounds(g.getBounds())}).addTo(l),L.easyButton("fa-question",function(e,t){$("#helpModal").modal("show")}).addTo(l),L.easyButton("fa-cog",function(e,t){$("#settingsModal").modal("show")}).addTo(l),d=[y,g],$.getJSON("/api/area",function(){}).done(function(e){o(d,e),l.fitBounds(d[1*(d[1].getLayers().length>0)].getBounds())}).fail(function(e){console.error(e)}).always(function(){}),function e(t,n=0){$.getJSON("/api/tree?time="+n,function(){}).done(function(e){e.length>0&&(console.log(e),o(t,e),e.forEach(e=>{$("body").trigger("update",e)}))}).fail(function(e){console.error(e.message)}).always(function(){n=Date.now(),setTimeout(function(){e(t,n)},1e4)})}([b,h]),l.locate({watch:!0,enableHighAccuracy:!0}),l.on("locationfound",function(e){var t=e.accuracy/2;u.setLatLng(e.latlng),u.setRadius(t)}),l.on("locationerror",function(e){l.locate({watch:!0,enableHighAccuracy:!1}),console.error(e.message)});var m=L.centerCross();function v(e,t){m.setVisible(!1),$(".dialog").addClass("inactive"),$("#"+e+"Dialog").removeClass("inactive"),$("body").trigger(e,t)}l.addLayer(m),m.setVisible(!1),$(".openDialog").on("click",function(e){v(e.target.attributes.open.nodeValue)}),$("body").on("add",function(e){m.setVisible(!0),$("#flyto").prop("checked")&&l.flyTo(u.getLatLng()),$("#size label").removeClass("active"),$("#size label:nth-child(2)").addClass("active"),$("#add").off().on("click",function(e){var t,o;t=$("#size label.active input").prop("id"),o=l.getCenter(),$.post("/api/tree",{size:t,lon:o.lng,lat:o.lat}).done(function(){n("success","Haufen erfolgreich hinzugefügt.")}).fail(function(){n("danger","Fehler")}).always(function(){v("main")})})}),$("body").on("main",function(e){}),$("body").on("edit",function(e,t){var o;console.log(t),secLevel>=3&&((o=$("select#user")).empty(),$.getJSON("/api/user/collectors",function(){}).done(function(e){e.forEach(e=>{o.append('<option value="'+e._id+'">'+e.name+"</option>")})}).fail(function(){n("danger","Fehler")}).always(function(){}));var a=$("#editLog");a.empty();var i=t.properties.status;i.forEach(e=>{var t=new Date(e.time);a.append("<tr><td>"+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+"</td><td>"+e.action+"</td></tr>")}),secLevel<3&&"add"!=i[i.length-1].action?$("#delete").prop("disabled",!0):$("#delete").prop("disabled",!1).off().on("click",function(e){var o;o=t._id,$.ajax({url:"/api/tree/"+o,method:"delete"}).done(function(){n("success","Haufen erfolgreich gelöscht.")}).fail(function(){n("danger","Fehler")}).always(function(){v("main")})}),$("#collect").off().on("click",function(e){var o;o=t._id,$.ajax({url:"/api/tree/"+o,method:"post"}).done(function(){n("success","Haufen erfolgreich gesammelt.")}).fail(function(){n("danger","Fehler")}).always(function(){v("main")})}),$("#assign").off().on("click",function(e){var o,a;o=t._id,a=$("select#user").val(),$.post("/api/tree/"+o+"/"+a,{}).done(function(){n("success","Haufen User zugewiesen.")}).fail(function(){n("danger","Fehler")}).always(function(){})}),console.log(t.properties.size),$("#editSize").prop("aria-valuenow",t.properties.size).css("width",33*t.properties.size+"%").html(t.properties.size)})}});